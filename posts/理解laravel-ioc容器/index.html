<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>理解Laravel IOC容器 | Time Capsule</title><meta name=keywords content="PHP,Composer"><meta name=description content="理解Laravel IOC容器 IOC容器是Laravel框架一个非常重要的概念
依赖注入 理解IOC容器首先要从依赖注入开始。依赖注入和控制反转是差不多因果关系，通过使用依赖注入这种手段实现功能模块对其依赖组件的控制反转。
拿一个使用OAuth登录应用场景举例：
interface Login { public function login(); } //微信账号登录 class WechatLogin implements Login { public function __construct(){} public function login() {} } //新浪微博登录 class WeiboLogin implements Login { public function __construct(){} public function login() {} } //QQ登录 class QQLogin implements Login { public function __construct(){} public function login() {} } //站点登录 class SiteLogin { protected $oauthClient; public function setOauthClient($oauthClient) { $this->oauthClient = $oauthClient } public function appLogin() { $this->oauthClient->login(); } } 一般可以使用两种方法实现注入"><meta name=author content><link rel=canonical href=https://shawnrong.github.io/posts/%E7%90%86%E8%A7%A3laravel-ioc%E5%AE%B9%E5%99%A8/><link crossorigin=anonymous href=/assets/css/stylesheet.min.d9015f4cb657fd3539b79b29ffbd11de4175ccd105ad7591beffaadfafb48488.css integrity="sha256-2QFfTLZX/TU5t5sp/70R3kF1zNEFrXWRvv+q36+0hIg=" rel="preload stylesheet" as=style><link rel=preload href=/icon.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><link rel=icon href=https://shawnrong.github.io/favicon_io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://shawnrong.github.io/favicon_io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://shawnrong.github.io/favicon_io/favicon-32x32.png><link rel=apple-touch-icon href=https://shawnrong.github.io/favicon_io/apple-touch-icon.png><link rel=mask-icon href=https://shawnrong.github.io/favicon_io/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.79.1"><meta property="og:title" content="理解Laravel IOC容器"><meta property="og:description" content="理解Laravel IOC容器 IOC容器是Laravel框架一个非常重要的概念
依赖注入 理解IOC容器首先要从依赖注入开始。依赖注入和控制反转是差不多因果关系，通过使用依赖注入这种手段实现功能模块对其依赖组件的控制反转。
拿一个使用OAuth登录应用场景举例：
interface Login { public function login(); } //微信账号登录 class WechatLogin implements Login { public function __construct(){} public function login() {} } //新浪微博登录 class WeiboLogin implements Login { public function __construct(){} public function login() {} } //QQ登录 class QQLogin implements Login { public function __construct(){} public function login() {} } //站点登录 class SiteLogin { protected $oauthClient; public function setOauthClient($oauthClient) { $this->oauthClient = $oauthClient } public function appLogin() { $this->oauthClient->login(); } } 一般可以使用两种方法实现注入"><meta property="og:type" content="article"><meta property="og:url" content="https://shawnrong.github.io/posts/%E7%90%86%E8%A7%A3laravel-ioc%E5%AE%B9%E5%99%A8/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-11-25T00:00:00+00:00"><meta property="article:modified_time" content="2017-11-25T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="理解Laravel IOC容器"><meta name=twitter:description content="理解Laravel IOC容器 IOC容器是Laravel框架一个非常重要的概念
依赖注入 理解IOC容器首先要从依赖注入开始。依赖注入和控制反转是差不多因果关系，通过使用依赖注入这种手段实现功能模块对其依赖组件的控制反转。
拿一个使用OAuth登录应用场景举例：
interface Login { public function login(); } //微信账号登录 class WechatLogin implements Login { public function __construct(){} public function login() {} } //新浪微博登录 class WeiboLogin implements Login { public function __construct(){} public function login() {} } //QQ登录 class QQLogin implements Login { public function __construct(){} public function login() {} } //站点登录 class SiteLogin { protected $oauthClient; public function setOauthClient($oauthClient) { $this->oauthClient = $oauthClient } public function appLogin() { $this->oauthClient->login(); } } 一般可以使用两种方法实现注入"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://shawnrong.github.io/posts/"},{"@type":"ListItem","position":2,"name":"理解Laravel IOC容器","item":"https://shawnrong.github.io/posts/%E7%90%86%E8%A7%A3laravel-ioc%E5%AE%B9%E5%99%A8/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"理解Laravel IOC容器","name":"理解Laravel IOC容器","description":"理解Laravel IOC容器 IOC容器是Laravel框架一个非常重要的概念\n依赖注入 理解IOC容器首先要从依赖注入开始。依赖注入和控制反转是差不多因果关系，通过使用依赖注入这种手段实现功能模块对其依赖组件的控制反转。\n拿一个使用OAuth登录应用场景举例：\ninterface Login { public function login(); } //微信账号登录 class WechatLogin implements Login { public function __construct(){} public function login() {} } //新浪微博登录 class WeiboLogin implements Login { public function __construct(){} public function login() {} } //QQ登录 class QQLogin implements Login { public function __construct(){} public function login() {} } //站点登录 class SiteLogin { protected $oauthClient; public function setOauthClient($oauthClient) { $this-\u0026gt;oauthClient = $oauthClient } public function appLogin() { $this-\u0026gt;oauthClient-\u0026gt;login(); } } 一般可以使用两种方法实现注入","keywords":["PHP","Composer"],"articleBody":"理解Laravel IOC容器 IOC容器是Laravel框架一个非常重要的概念\n依赖注入 理解IOC容器首先要从依赖注入开始。依赖注入和控制反转是差不多因果关系，通过使用依赖注入这种手段实现功能模块对其依赖组件的控制反转。\n拿一个使用OAuth登录应用场景举例：\ninterface Login { public function login(); } //微信账号登录 class WechatLogin implements Login { public function __construct(){} public function login() {} } //新浪微博登录 class WeiboLogin implements Login { public function __construct(){} public function login() {} } //QQ登录 class QQLogin implements Login { public function __construct(){} public function login() {} } //站点登录 class SiteLogin { protected $oauthClient; public function setOauthClient($oauthClient) { $this-oauthClient = $oauthClient } public function appLogin() { $this-oauthClient-login(); } } 一般可以使用两种方法实现注入\n 通过构造函数注入依赖 通过setter设置方法注入  依赖注入的作用就是使程序更容易维护，降低代码的耦合度。但是，依赖注入也有缺点，就是每次都需要实例化，如果组件中有很多的依赖关系，就需要多个setter或者创建构造方法传递。这就需要用到了依赖注入容器\nLaravel的容器 在Laravel框架中，服务容器是整个框架的核心，它提供了整个系统功能及服务的配置，调用。当程序运行时，我们把需要的一些服务放到或者注册到(bind)到容器中，当我们需要的时候直接取出来(make)。\nphp //容器类装实例或提供实例的回调函数 class Container { //用于装提供实例的回调函数，真正的容器还会装实例等其他内容  //从而实现单例等高级功能  protected $bindings = []; //绑定接口和生成相应实例的回调函数  public function bind($abstract, $concrete=null, $shared=false) { //如果提供的参数不是回调函数，则产生默认的回调函数  if(!$concrete instanceof Closure) { $concrete = $this-getClosure($abstract, $concrete); } $this-bindings[$abstract] = compact('concrete', 'shared'); } //默认生成实例的回调函数  protected function getClosure($abstract, $concrete) { return function($c) use ($abstract, $concrete) { $method = ($abstract == $concrete) ? 'build' : 'make'; return $c-$method($concrete); }; } public function make($abstract) { $concrete = $this-getConcrete($abstract); if($this-isBuildable($concrete, $abstract)) { $object = $this-build($concrete); } else { $object = $this-make($concrete); } return $object; } protected function isBuildable($concrete, $abstract) { return $concrete === $abstract || $concrete instanceof Closure; } //获取绑定的回调函数  protected function getConcrete($abstract) { if(!isset($this-bindings[$abstract])) { return $abstract; } return $this-bindings[$abstract]['concrete']; } //实例化对象  public function build($concrete) { if($concrete instanceof Closure) { return $concrete($this); } $reflector = new ReflectionClass($concrete); if(!$reflector-isInstantiable()) { echo $message = \"Target [$concrete] is not instantiable\"; } $constructor = $reflector-getConstructor(); if(is_null($constructor)) { return new $concrete; } $dependencies = $constructor-getParameters(); $instances = $this-getDependencies($dependencies); return $reflector-newInstanceArgs($instances); } //解决通过反射机制实例化对象时的依赖  protected function getDependencies($parameters) { $dependencies = []; foreach($parameters as $parameter) { $dependency = $parameter-getClass(); if(is_null($dependency)) { $dependencies[] = NULL; } else { $dependencies[] = $this-resolveClass($parameter); } } return (array)$dependencies; } protected function resolveClass(ReflectionParameter $parameter) { return $this-make($parameter-getClass()-name); } } 以上代码定义了一个容器\n$app = new Container(); $app-bind(\"Login\", \"WechatLogin\");//Login 为接口， WechatLogin 是 class WechatLogin $app-bind(\"siteLogin\", \"SiteLogin\"); //siteLogin可以当做是Class SiteLogin 的服务别名  //通过字符解析，或得到了Class SiteLogin 的实例 $login = $app-make(\"siteLogin\"); $login-appLogin(); 参考   如何理解 Laravel 的 IoC 容器 Laravel IoC Container: Why we need it and How it works Laravel5.6文档   ","wordCount":"317","inLanguage":"en","datePublished":"2017-11-25T00:00:00Z","dateModified":"2017-11-25T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://shawnrong.github.io/posts/%E7%90%86%E8%A7%A3laravel-ioc%E5%AE%B9%E5%99%A8/"},"publisher":{"@type":"Organization","name":"Time Capsule","logo":{"@type":"ImageObject","url":"https://shawnrong.github.io/favicon_io/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: #1d1e20;--entry: #2e2e33;--primary: rgba(255, 255, 255, 0.84);--secondary: rgba(255, 255, 255, 0.56);--tertiary: rgba(255, 255, 255, 0.16);--content: rgba(255, 255, 255, 0.74);--hljs-bg: #2e2e33;--code-bg: #37383e;--border: #333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://shawnrong.github.io/ accesskey=h title="Time Capsule (Alt + H)"><img src=/icon.png alt=logo aria-label=logo height=30px>Time Capsule</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://shawnrong.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://shawnrong.github.io/tags title=️Tag><span>️Tag</span></a></li><li><a href=https://shawnrong.github.io/archive title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>理解Laravel IOC容器</h1><div class=post-meta>November 25, 2017&nbsp;·&nbsp;2 min</div></header><div class=post-content><h1 id=理解laravel-ioc容器>理解Laravel IOC容器<a hidden class=anchor aria-hidden=true href=#理解laravel-ioc容器>#</a></h1><p>IOC容器是Laravel框架一个非常重要的概念</p><h2 id=依赖注入>依赖注入<a hidden class=anchor aria-hidden=true href=#依赖注入>#</a></h2><p>理解IOC容器首先要从依赖注入开始。<strong>依赖注入</strong>和<strong>控制反转</strong>是差不多因果关系，通过使用<strong>依赖注入</strong>这种手段实现功能模块对其依赖组件的<strong>控制反转</strong>。</p><p>拿一个使用OAuth登录应用场景举例：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Login</span> {
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>login</span>();
}
<span style=color:#75715e>//微信账号登录
</span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WechatLogin</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>Login</span> {
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct(){}
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>login</span>() {}
}
<span style=color:#75715e>//新浪微博登录
</span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WeiboLogin</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>Login</span> {
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct(){}
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>login</span>() {}
}
<span style=color:#75715e>//QQ登录
</span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>QQLogin</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>Login</span> {
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct(){}
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>login</span>() {}
}
<span style=color:#75715e>//站点登录
</span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SiteLogin</span> {
    <span style=color:#66d9ef>protected</span> $oauthClient;
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setOauthClient</span>($oauthClient) {
        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>oauthClient</span> <span style=color:#f92672>=</span> $oauthClient
    }
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>appLogin</span>() {
        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>oauthClient</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>login</span>();
    }
}

</code></pre></div><p>一般可以使用两种方法实现注入</p><ol><li>通过构造函数注入依赖</li><li>通过setter设置方法注入</li></ol><p>依赖注入的作用就是使程序更容易维护，降低代码的耦合度。但是，依赖注入也有缺点，就是每次都需要实例化，如果组件中有很多的依赖关系，就需要多个setter或者创建构造方法传递。这就需要用到了<strong>依赖注入容器</strong></p><h2 id=laravel的容器>Laravel的容器<a hidden class=anchor aria-hidden=true href=#laravel的容器>#</a></h2><p>在Laravel框架中，服务容器是整个框架的核心，它提供了整个系统功能及服务的配置，调用。当程序运行时，我们把需要的一些服务放到或者注册到(bind)到容器中，当我们需要的时候直接取出来(make)。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>

<span style=color:#75715e>//容器类装实例或提供实例的回调函数
</span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Container</span> {

    <span style=color:#75715e>//用于装提供实例的回调函数，真正的容器还会装实例等其他内容
</span><span style=color:#75715e></span>    <span style=color:#75715e>//从而实现单例等高级功能
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> $bindings <span style=color:#f92672>=</span> [];

    <span style=color:#75715e>//绑定接口和生成相应实例的回调函数
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>bind</span>($abstract, $concrete<span style=color:#f92672>=</span><span style=color:#66d9ef>null</span>, $shared<span style=color:#f92672>=</span><span style=color:#66d9ef>false</span>) {

        <span style=color:#75715e>//如果提供的参数不是回调函数，则产生默认的回调函数
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$concrete <span style=color:#a6e22e>instanceof</span> <span style=color:#a6e22e>Closure</span>) {
            $concrete <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getClosure</span>($abstract, $concrete);
        }

        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>bindings</span>[$abstract] <span style=color:#f92672>=</span> <span style=color:#a6e22e>compact</span>(<span style=color:#e6db74>&#39;concrete&#39;</span>, <span style=color:#e6db74>&#39;shared&#39;</span>);
    }

    <span style=color:#75715e>//默认生成实例的回调函数
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getClosure</span>($abstract, $concrete) {

        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>function</span>($c) <span style=color:#66d9ef>use</span> ($abstract, $concrete) {
            $method <span style=color:#f92672>=</span> ($abstract <span style=color:#f92672>==</span> $concrete) <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;build&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;make&#39;</span>;
            <span style=color:#66d9ef>return</span> $c<span style=color:#f92672>-&gt;</span>$method($concrete);
        };

    }

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>make</span>($abstract) {
        $concrete <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getConcrete</span>($abstract);

        <span style=color:#66d9ef>if</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isBuildable</span>($concrete, $abstract)) {
            $object <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>build</span>($concrete);
        } <span style=color:#66d9ef>else</span> {
            $object <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>make</span>($concrete);
        }

        <span style=color:#66d9ef>return</span> $object;
    }

    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>isBuildable</span>($concrete, $abstract) {
        <span style=color:#66d9ef>return</span> $concrete <span style=color:#f92672>===</span> $abstract <span style=color:#f92672>||</span> $concrete <span style=color:#a6e22e>instanceof</span> <span style=color:#a6e22e>Closure</span>;
    }

    <span style=color:#75715e>//获取绑定的回调函数
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getConcrete</span>($abstract) {
        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>bindings</span>[$abstract])) {
            <span style=color:#66d9ef>return</span> $abstract;
        }

        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>bindings</span>[$abstract][<span style=color:#e6db74>&#39;concrete&#39;</span>];
    }

    <span style=color:#75715e>//实例化对象
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>build</span>($concrete) {

        <span style=color:#66d9ef>if</span>($concrete <span style=color:#a6e22e>instanceof</span> <span style=color:#a6e22e>Closure</span>) {
            <span style=color:#66d9ef>return</span> $concrete($this);
        }

        $reflector <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ReflectionClass</span>($concrete);
        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$reflector<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isInstantiable</span>()) {
            <span style=color:#66d9ef>echo</span> $message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Target [</span><span style=color:#e6db74>$concrete</span><span style=color:#e6db74>] is not instantiable&#34;</span>;
        }

        $constructor <span style=color:#f92672>=</span> $reflector<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getConstructor</span>();
        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>is_null</span>($constructor)) {
            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> $concrete;
        }

        $dependencies <span style=color:#f92672>=</span> $constructor<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getParameters</span>();
        $instances <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getDependencies</span>($dependencies);

        <span style=color:#66d9ef>return</span> $reflector<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>newInstanceArgs</span>($instances);
    }

    <span style=color:#75715e>//解决通过反射机制实例化对象时的依赖
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getDependencies</span>($parameters) {
        $dependencies <span style=color:#f92672>=</span> [];
        <span style=color:#66d9ef>foreach</span>($parameters <span style=color:#66d9ef>as</span> $parameter) {
            $dependency <span style=color:#f92672>=</span> $parameter<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getClass</span>();
            <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>is_null</span>($dependency)) {
                $dependencies[] <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>;
            } <span style=color:#66d9ef>else</span> {
                $dependencies[] <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>resolveClass</span>($parameter);
            }
        }

        <span style=color:#66d9ef>return</span> (<span style=color:#66d9ef>array</span>)$dependencies;
    }

    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>resolveClass</span>(<span style=color:#a6e22e>ReflectionParameter</span> $parameter) {
        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>make</span>($parameter<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getClass</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>name</span>);
    }

}
</code></pre></div><p>以上代码定义了一个容器</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$app <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Container</span>();
$app<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>bind</span>(<span style=color:#e6db74>&#34;Login&#34;</span>, <span style=color:#e6db74>&#34;WechatLogin&#34;</span>);<span style=color:#75715e>//Login 为接口， WechatLogin 是 class WechatLogin
</span><span style=color:#75715e></span>$app<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>bind</span>(<span style=color:#e6db74>&#34;siteLogin&#34;</span>, <span style=color:#e6db74>&#34;SiteLogin&#34;</span>); <span style=color:#75715e>//siteLogin可以当做是Class SiteLogin 的服务别名
</span><span style=color:#75715e></span>
<span style=color:#75715e>//通过字符解析，或得到了Class SiteLogin 的实例
</span><span style=color:#75715e></span>$login <span style=color:#f92672>=</span> $app<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>make</span>(<span style=color:#e6db74>&#34;siteLogin&#34;</span>);

$login<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>appLogin</span>();
</code></pre></div><h3 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h3><blockquote><ul><li><a href=https://laravel-china.org/articles/4076/how-to-understand-laravels-ioc-container>如何理解 Laravel 的 IoC 容器</a></li><li><a href=https://medium.com/@NahidulHasan/laravel-ioc-container-why-we-need-it-and-how-it-works-a603d4cef10f><strong>Laravel IoC Container: Why we need it and How it works</strong></a></li><li><a href=https://laravel.com/docs/5.6/container>Laravel5.6文档</a></li></ul></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://shawnrong.github.io/tags/php/>PHP</a></li><li><a href=https://shawnrong.github.io/tags/composer/>Composer</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://shawnrong.github.io/>Time Capsule</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu')
menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>