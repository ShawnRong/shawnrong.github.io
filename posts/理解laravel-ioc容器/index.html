<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ç†è§£Laravel IOCå®¹å™¨ | ğŸ’ŠTime Capsule</title><meta name=keywords content="PHP,Composer"><meta name=description content="ç†è§£Laravel IOCå®¹å™¨ IOCå®¹å™¨æ˜¯Laravelæ¡†æ¶ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µ
ä¾èµ–æ³¨å…¥ ç†è§£IOCå®¹å™¨é¦–å…ˆè¦ä»ä¾èµ–æ³¨å…¥å¼€å§‹ã€‚ä¾èµ–æ³¨å…¥å’Œæ§åˆ¶åè½¬æ˜¯å·®ä¸å¤šå› æœå…³ç³»ï¼Œé€šè¿‡ä½¿ç”¨ä¾èµ–æ³¨å…¥è¿™ç§æ‰‹æ®µå®ç°åŠŸèƒ½æ¨¡å—å¯¹å…¶ä¾èµ–ç»„ä»¶çš„æ§åˆ¶åè½¬ã€‚
æ‹¿ä¸€ä¸ªä½¿ç”¨OAuthç™»å½•åº”ç”¨åœºæ™¯ä¸¾ä¾‹ï¼š
interface Login { public function login(); } //å¾®ä¿¡è´¦å·ç™»å½• class WechatLogin implements Login { public function __construct(){} public function login() {} } //æ–°æµªå¾®åšç™»å½• class WeiboLogin implements Login { public function __construct(){} public function login() {} } //QQç™»å½• class QQLogin implements Login { public function __construct(){} public function login() {} } //ç«™ç‚¹ç™»å½• class SiteLogin { protected $oauthClient; public function setOauthClient($oauthClient) { $this->oauthClient = $oauthClient } public function appLogin() { $this->oauthClient->login(); } } ä¸€èˆ¬å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹æ³•å®ç°æ³¨å…¥"><meta name=author content><link rel=canonical href=http://shawnrong.github.io/posts/%E7%90%86%E8%A7%A3laravel-ioc%E5%AE%B9%E5%99%A8/><link href=http://shawnrong.github.io/assets/css/stylesheet.min.19d8234f7520f2216aca845b9f292982671403accc7e754ceb099b228a5980fe.css integrity="sha256-GdgjT3Ug8iFqyoRbnykpgmcUA6zMfnVM6wmbIopZgP4=" rel="preload stylesheet" as=style><link rel=icon href=http://shawnrong.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://shawnrong.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://shawnrong.github.io/favicon-32x32.png><link rel=apple-touch-icon href=http://shawnrong.github.io/apple-touch-icon.png><link rel=mask-icon href=http://shawnrong.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.79.1"><meta property="og:title" content="ç†è§£Laravel IOCå®¹å™¨"><meta property="og:description" content="ç†è§£Laravel IOCå®¹å™¨ IOCå®¹å™¨æ˜¯Laravelæ¡†æ¶ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µ
ä¾èµ–æ³¨å…¥ ç†è§£IOCå®¹å™¨é¦–å…ˆè¦ä»ä¾èµ–æ³¨å…¥å¼€å§‹ã€‚ä¾èµ–æ³¨å…¥å’Œæ§åˆ¶åè½¬æ˜¯å·®ä¸å¤šå› æœå…³ç³»ï¼Œé€šè¿‡ä½¿ç”¨ä¾èµ–æ³¨å…¥è¿™ç§æ‰‹æ®µå®ç°åŠŸèƒ½æ¨¡å—å¯¹å…¶ä¾èµ–ç»„ä»¶çš„æ§åˆ¶åè½¬ã€‚
æ‹¿ä¸€ä¸ªä½¿ç”¨OAuthç™»å½•åº”ç”¨åœºæ™¯ä¸¾ä¾‹ï¼š
interface Login { public function login(); } //å¾®ä¿¡è´¦å·ç™»å½• class WechatLogin implements Login { public function __construct(){} public function login() {} } //æ–°æµªå¾®åšç™»å½• class WeiboLogin implements Login { public function __construct(){} public function login() {} } //QQç™»å½• class QQLogin implements Login { public function __construct(){} public function login() {} } //ç«™ç‚¹ç™»å½• class SiteLogin { protected $oauthClient; public function setOauthClient($oauthClient) { $this->oauthClient = $oauthClient } public function appLogin() { $this->oauthClient->login(); } } ä¸€èˆ¬å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹æ³•å®ç°æ³¨å…¥"><meta property="og:type" content="article"><meta property="og:url" content="http://shawnrong.github.io/posts/%E7%90%86%E8%A7%A3laravel-ioc%E5%AE%B9%E5%99%A8/"><meta property="article:published_time" content="2017-11-25T00:00:00+00:00"><meta property="article:modified_time" content="2017-11-25T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="ç†è§£Laravel IOCå®¹å™¨"><meta name=twitter:description content="ç†è§£Laravel IOCå®¹å™¨ IOCå®¹å™¨æ˜¯Laravelæ¡†æ¶ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µ
ä¾èµ–æ³¨å…¥ ç†è§£IOCå®¹å™¨é¦–å…ˆè¦ä»ä¾èµ–æ³¨å…¥å¼€å§‹ã€‚ä¾èµ–æ³¨å…¥å’Œæ§åˆ¶åè½¬æ˜¯å·®ä¸å¤šå› æœå…³ç³»ï¼Œé€šè¿‡ä½¿ç”¨ä¾èµ–æ³¨å…¥è¿™ç§æ‰‹æ®µå®ç°åŠŸèƒ½æ¨¡å—å¯¹å…¶ä¾èµ–ç»„ä»¶çš„æ§åˆ¶åè½¬ã€‚
æ‹¿ä¸€ä¸ªä½¿ç”¨OAuthç™»å½•åº”ç”¨åœºæ™¯ä¸¾ä¾‹ï¼š
interface Login { public function login(); } //å¾®ä¿¡è´¦å·ç™»å½• class WechatLogin implements Login { public function __construct(){} public function login() {} } //æ–°æµªå¾®åšç™»å½• class WeiboLogin implements Login { public function __construct(){} public function login() {} } //QQç™»å½• class QQLogin implements Login { public function __construct(){} public function login() {} } //ç«™ç‚¹ç™»å½• class SiteLogin { protected $oauthClient; public function setOauthClient($oauthClient) { $this->oauthClient = $oauthClient } public function appLogin() { $this->oauthClient->login(); } } ä¸€èˆ¬å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹æ³•å®ç°æ³¨å…¥"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ç†è§£Laravel IOCå®¹å™¨","name":"ç†è§£Laravel IOCå®¹å™¨","description":"ç†è§£Laravel IOCå®¹å™¨ IOCå®¹å™¨æ˜¯Laravelæ¡†æ¶ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µ\nä¾èµ–æ³¨å…¥ ç†è§£IOCå®¹å™¨é¦–å…ˆè¦ä»ä¾èµ–æ³¨å…¥å¼€å§‹ã€‚ä¾èµ–æ³¨å…¥å’Œæ§åˆ¶åè½¬æ˜¯å·®ä¸å¤šå› æœå…³ç³»ï¼Œé€šè¿‡ä½¿ç”¨ä¾èµ–æ³¨å…¥è¿™ç§æ‰‹æ®µå®ç°åŠŸèƒ½æ¨¡å—å¯¹å…¶ä¾èµ–ç»„ä»¶çš„æ§åˆ¶åè½¬ã€‚\næ‹¿ä¸€ä¸ªä½¿ç”¨OAuthç™»å½•åº”ç”¨åœºæ™¯ä¸¾ä¾‹ï¼š\ninterface Login { public function login(); } // â€¦","keywords":["PHP","Composer"],"articleBody":"ç†è§£Laravel IOCå®¹å™¨ IOCå®¹å™¨æ˜¯Laravelæ¡†æ¶ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µ\nä¾èµ–æ³¨å…¥ ç†è§£IOCå®¹å™¨é¦–å…ˆè¦ä»ä¾èµ–æ³¨å…¥å¼€å§‹ã€‚ä¾èµ–æ³¨å…¥å’Œæ§åˆ¶åè½¬æ˜¯å·®ä¸å¤šå› æœå…³ç³»ï¼Œé€šè¿‡ä½¿ç”¨ä¾èµ–æ³¨å…¥è¿™ç§æ‰‹æ®µå®ç°åŠŸèƒ½æ¨¡å—å¯¹å…¶ä¾èµ–ç»„ä»¶çš„æ§åˆ¶åè½¬ã€‚\næ‹¿ä¸€ä¸ªä½¿ç”¨OAuthç™»å½•åº”ç”¨åœºæ™¯ä¸¾ä¾‹ï¼š\ninterface Login { public function login(); } //å¾®ä¿¡è´¦å·ç™»å½• class WechatLogin implements Login { public function __construct(){} public function login() {} } //æ–°æµªå¾®åšç™»å½• class WeiboLogin implements Login { public function __construct(){} public function login() {} } //QQç™»å½• class QQLogin implements Login { public function __construct(){} public function login() {} } //ç«™ç‚¹ç™»å½• class SiteLogin { protected $oauthClient; public function setOauthClient($oauthClient) { $this-oauthClient = $oauthClient } public function appLogin() { $this-oauthClient-login(); } } ä¸€èˆ¬å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹æ³•å®ç°æ³¨å…¥\n é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ– é€šè¿‡setterè®¾ç½®æ–¹æ³•æ³¨å…¥  ä¾èµ–æ³¨å…¥çš„ä½œç”¨å°±æ˜¯ä½¿ç¨‹åºæ›´å®¹æ˜“ç»´æŠ¤ï¼Œé™ä½ä»£ç çš„è€¦åˆåº¦ã€‚ä½†æ˜¯ï¼Œä¾èµ–æ³¨å…¥ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå°±æ˜¯æ¯æ¬¡éƒ½éœ€è¦å®ä¾‹åŒ–ï¼Œå¦‚æœç»„ä»¶ä¸­æœ‰å¾ˆå¤šçš„ä¾èµ–å…³ç³»ï¼Œå°±éœ€è¦å¤šä¸ªsetteræˆ–è€…åˆ›å»ºæ„é€ æ–¹æ³•ä¼ é€’ã€‚è¿™å°±éœ€è¦ç”¨åˆ°äº†ä¾èµ–æ³¨å…¥å®¹å™¨\nLaravelçš„å®¹å™¨ åœ¨Laravelæ¡†æ¶ä¸­ï¼ŒæœåŠ¡å®¹å™¨æ˜¯æ•´ä¸ªæ¡†æ¶çš„æ ¸å¿ƒï¼Œå®ƒæä¾›äº†æ•´ä¸ªç³»ç»ŸåŠŸèƒ½åŠæœåŠ¡çš„é…ç½®ï¼Œè°ƒç”¨ã€‚å½“ç¨‹åºè¿è¡Œæ—¶ï¼Œæˆ‘ä»¬æŠŠéœ€è¦çš„ä¸€äº›æœåŠ¡æ”¾åˆ°æˆ–è€…æ³¨å†Œåˆ°(bind)åˆ°å®¹å™¨ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦çš„æ—¶å€™ç›´æ¥å–å‡ºæ¥(make)ã€‚\nphp //å®¹å™¨ç±»è£…å®ä¾‹æˆ–æä¾›å®ä¾‹çš„å›è°ƒå‡½æ•° class Container { //ç”¨äºè£…æä¾›å®ä¾‹çš„å›è°ƒå‡½æ•°ï¼ŒçœŸæ­£çš„å®¹å™¨è¿˜ä¼šè£…å®ä¾‹ç­‰å…¶ä»–å†…å®¹  //ä»è€Œå®ç°å•ä¾‹ç­‰é«˜çº§åŠŸèƒ½  protected $bindings = []; //ç»‘å®šæ¥å£å’Œç”Ÿæˆç›¸åº”å®ä¾‹çš„å›è°ƒå‡½æ•°  public function bind($abstract, $concrete=null, $shared=false) { //å¦‚æœæä¾›çš„å‚æ•°ä¸æ˜¯å›è°ƒå‡½æ•°ï¼Œåˆ™äº§ç”Ÿé»˜è®¤çš„å›è°ƒå‡½æ•°  if(!$concrete instanceof Closure) { $concrete = $this-getClosure($abstract, $concrete); } $this-bindings[$abstract] = compact('concrete', 'shared'); } //é»˜è®¤ç”Ÿæˆå®ä¾‹çš„å›è°ƒå‡½æ•°  protected function getClosure($abstract, $concrete) { return function($c) use ($abstract, $concrete) { $method = ($abstract == $concrete) ? 'build' : 'make'; return $c-$method($concrete); }; } public function make($abstract) { $concrete = $this-getConcrete($abstract); if($this-isBuildable($concrete, $abstract)) { $object = $this-build($concrete); } else { $object = $this-make($concrete); } return $object; } protected function isBuildable($concrete, $abstract) { return $concrete === $abstract || $concrete instanceof Closure; } //è·å–ç»‘å®šçš„å›è°ƒå‡½æ•°  protected function getConcrete($abstract) { if(!isset($this-bindings[$abstract])) { return $abstract; } return $this-bindings[$abstract]['concrete']; } //å®ä¾‹åŒ–å¯¹è±¡  public function build($concrete) { if($concrete instanceof Closure) { return $concrete($this); } $reflector = new ReflectionClass($concrete); if(!$reflector-isInstantiable()) { echo $message = \"Target [$concrete] is not instantiable\"; } $constructor = $reflector-getConstructor(); if(is_null($constructor)) { return new $concrete; } $dependencies = $constructor-getParameters(); $instances = $this-getDependencies($dependencies); return $reflector-newInstanceArgs($instances); } //è§£å†³é€šè¿‡åå°„æœºåˆ¶å®ä¾‹åŒ–å¯¹è±¡æ—¶çš„ä¾èµ–  protected function getDependencies($parameters) { $dependencies = []; foreach($parameters as $parameter) { $dependency = $parameter-getClass(); if(is_null($dependency)) { $dependencies[] = NULL; } else { $dependencies[] = $this-resolveClass($parameter); } } return (array)$dependencies; } protected function resolveClass(ReflectionParameter $parameter) { return $this-make($parameter-getClass()-name); } } ä»¥ä¸Šä»£ç å®šä¹‰äº†ä¸€ä¸ªå®¹å™¨\n$app = new Container(); $app-bind(\"Login\", \"WechatLogin\");//Login ä¸ºæ¥å£ï¼Œ WechatLogin æ˜¯ class WechatLogin $app-bind(\"siteLogin\", \"SiteLogin\"); //siteLoginå¯ä»¥å½“åšæ˜¯Class SiteLogin çš„æœåŠ¡åˆ«å  //é€šè¿‡å­—ç¬¦è§£æï¼Œæˆ–å¾—åˆ°äº†Class SiteLogin çš„å®ä¾‹ $login = $app-make(\"siteLogin\"); $login-appLogin(); å‚è€ƒ   å¦‚ä½•ç†è§£ Laravel çš„ IoC å®¹å™¨ Laravel IoC Container: Why we need it and How it works Laravel5.6æ–‡æ¡£   ","wordCount":"317","inLanguage":"en","datePublished":"2017-11-25T00:00:00Z","dateModified":"2017-11-25T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"http://shawnrong.github.io/posts/%E7%90%86%E8%A7%A3laravel-ioc%E5%AE%B9%E5%99%A8/"},"publisher":{"@type":"Organization","name":"ğŸ’ŠTime Capsule","logo":{"@type":"ImageObject","url":"http://shawnrong.github.io/favicon.ico"}}}</script></head><body id=top><script>if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=http://shawnrong.github.io/ accesskey=h title="ğŸ’ŠTime Capsule (Alt + H)">ğŸ’ŠTime Capsule</a>
<span class=logo-switches></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=http://shawnrong.github.io/search title="ğŸ” (Alt + /)" accesskey=/><span>ğŸ”</span></a></li><li><a href=http://shawnrong.github.io/tags title=ğŸ·ï¸><span>ğŸ·ï¸</span></a></li><li><a href=http://shawnrong.github.io/archive title=ğŸ§³><span>ğŸ§³</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>ç†è§£Laravel IOCå®¹å™¨</h1><div class=post-description></div><div class=post-meta>November 25, 2017&nbsp;Â·&nbsp;2 min</div></header><div class=post-content><h1 id=ç†è§£laravel-iocå®¹å™¨>ç†è§£Laravel IOCå®¹å™¨<a hidden class=anchor aria-hidden=true href=#ç†è§£laravel-iocå®¹å™¨>#</a></h1><p>IOCå®¹å™¨æ˜¯Laravelæ¡†æ¶ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µ</p><h2 id=ä¾èµ–æ³¨å…¥>ä¾èµ–æ³¨å…¥<a hidden class=anchor aria-hidden=true href=#ä¾èµ–æ³¨å…¥>#</a></h2><p>ç†è§£IOCå®¹å™¨é¦–å…ˆè¦ä»ä¾èµ–æ³¨å…¥å¼€å§‹ã€‚<strong>ä¾èµ–æ³¨å…¥</strong>å’Œ<strong>æ§åˆ¶åè½¬</strong>æ˜¯å·®ä¸å¤šå› æœå…³ç³»ï¼Œé€šè¿‡ä½¿ç”¨<strong>ä¾èµ–æ³¨å…¥</strong>è¿™ç§æ‰‹æ®µå®ç°åŠŸèƒ½æ¨¡å—å¯¹å…¶ä¾èµ–ç»„ä»¶çš„<strong>æ§åˆ¶åè½¬</strong>ã€‚</p><p>æ‹¿ä¸€ä¸ªä½¿ç”¨OAuthç™»å½•åº”ç”¨åœºæ™¯ä¸¾ä¾‹ï¼š</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Login</span> {
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>login</span>();
}
<span style=color:#75715e>//å¾®ä¿¡è´¦å·ç™»å½•
</span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WechatLogin</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>Login</span> {
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct(){}
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>login</span>() {}
}
<span style=color:#75715e>//æ–°æµªå¾®åšç™»å½•
</span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WeiboLogin</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>Login</span> {
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct(){}
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>login</span>() {}
}
<span style=color:#75715e>//QQç™»å½•
</span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>QQLogin</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>Login</span> {
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct(){}
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>login</span>() {}
}
<span style=color:#75715e>//ç«™ç‚¹ç™»å½•
</span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SiteLogin</span> {
    <span style=color:#66d9ef>protected</span> $oauthClient;
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setOauthClient</span>($oauthClient) {
        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>oauthClient</span> <span style=color:#f92672>=</span> $oauthClient
    }
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>appLogin</span>() {
        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>oauthClient</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>login</span>();
    }
}

</code></pre></div><p>ä¸€èˆ¬å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹æ³•å®ç°æ³¨å…¥</p><ol><li>é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–</li><li>é€šè¿‡setterè®¾ç½®æ–¹æ³•æ³¨å…¥</li></ol><p>ä¾èµ–æ³¨å…¥çš„ä½œç”¨å°±æ˜¯ä½¿ç¨‹åºæ›´å®¹æ˜“ç»´æŠ¤ï¼Œé™ä½ä»£ç çš„è€¦åˆåº¦ã€‚ä½†æ˜¯ï¼Œä¾èµ–æ³¨å…¥ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå°±æ˜¯æ¯æ¬¡éƒ½éœ€è¦å®ä¾‹åŒ–ï¼Œå¦‚æœç»„ä»¶ä¸­æœ‰å¾ˆå¤šçš„ä¾èµ–å…³ç³»ï¼Œå°±éœ€è¦å¤šä¸ªsetteræˆ–è€…åˆ›å»ºæ„é€ æ–¹æ³•ä¼ é€’ã€‚è¿™å°±éœ€è¦ç”¨åˆ°äº†<strong>ä¾èµ–æ³¨å…¥å®¹å™¨</strong></p><h2 id=laravelçš„å®¹å™¨>Laravelçš„å®¹å™¨<a hidden class=anchor aria-hidden=true href=#laravelçš„å®¹å™¨>#</a></h2><p>åœ¨Laravelæ¡†æ¶ä¸­ï¼ŒæœåŠ¡å®¹å™¨æ˜¯æ•´ä¸ªæ¡†æ¶çš„æ ¸å¿ƒï¼Œå®ƒæä¾›äº†æ•´ä¸ªç³»ç»ŸåŠŸèƒ½åŠæœåŠ¡çš„é…ç½®ï¼Œè°ƒç”¨ã€‚å½“ç¨‹åºè¿è¡Œæ—¶ï¼Œæˆ‘ä»¬æŠŠéœ€è¦çš„ä¸€äº›æœåŠ¡æ”¾åˆ°æˆ–è€…æ³¨å†Œåˆ°(bind)åˆ°å®¹å™¨ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦çš„æ—¶å€™ç›´æ¥å–å‡ºæ¥(make)ã€‚</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>

<span style=color:#75715e>//å®¹å™¨ç±»è£…å®ä¾‹æˆ–æä¾›å®ä¾‹çš„å›è°ƒå‡½æ•°
</span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Container</span> {

    <span style=color:#75715e>//ç”¨äºè£…æä¾›å®ä¾‹çš„å›è°ƒå‡½æ•°ï¼ŒçœŸæ­£çš„å®¹å™¨è¿˜ä¼šè£…å®ä¾‹ç­‰å…¶ä»–å†…å®¹
</span><span style=color:#75715e></span>    <span style=color:#75715e>//ä»è€Œå®ç°å•ä¾‹ç­‰é«˜çº§åŠŸèƒ½
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> $bindings <span style=color:#f92672>=</span> [];

    <span style=color:#75715e>//ç»‘å®šæ¥å£å’Œç”Ÿæˆç›¸åº”å®ä¾‹çš„å›è°ƒå‡½æ•°
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>bind</span>($abstract, $concrete<span style=color:#f92672>=</span><span style=color:#66d9ef>null</span>, $shared<span style=color:#f92672>=</span><span style=color:#66d9ef>false</span>) {

        <span style=color:#75715e>//å¦‚æœæä¾›çš„å‚æ•°ä¸æ˜¯å›è°ƒå‡½æ•°ï¼Œåˆ™äº§ç”Ÿé»˜è®¤çš„å›è°ƒå‡½æ•°
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$concrete <span style=color:#a6e22e>instanceof</span> <span style=color:#a6e22e>Closure</span>) {
            $concrete <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getClosure</span>($abstract, $concrete);
        }

        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>bindings</span>[$abstract] <span style=color:#f92672>=</span> <span style=color:#a6e22e>compact</span>(<span style=color:#e6db74>&#39;concrete&#39;</span>, <span style=color:#e6db74>&#39;shared&#39;</span>);
    }

    <span style=color:#75715e>//é»˜è®¤ç”Ÿæˆå®ä¾‹çš„å›è°ƒå‡½æ•°
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getClosure</span>($abstract, $concrete) {

        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>function</span>($c) <span style=color:#66d9ef>use</span> ($abstract, $concrete) {
            $method <span style=color:#f92672>=</span> ($abstract <span style=color:#f92672>==</span> $concrete) <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;build&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;make&#39;</span>;
            <span style=color:#66d9ef>return</span> $c<span style=color:#f92672>-&gt;</span>$method($concrete);
        };

    }

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>make</span>($abstract) {
        $concrete <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getConcrete</span>($abstract);

        <span style=color:#66d9ef>if</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isBuildable</span>($concrete, $abstract)) {
            $object <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>build</span>($concrete);
        } <span style=color:#66d9ef>else</span> {
            $object <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>make</span>($concrete);
        }

        <span style=color:#66d9ef>return</span> $object;
    }

    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>isBuildable</span>($concrete, $abstract) {
        <span style=color:#66d9ef>return</span> $concrete <span style=color:#f92672>===</span> $abstract <span style=color:#f92672>||</span> $concrete <span style=color:#a6e22e>instanceof</span> <span style=color:#a6e22e>Closure</span>;
    }

    <span style=color:#75715e>//è·å–ç»‘å®šçš„å›è°ƒå‡½æ•°
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getConcrete</span>($abstract) {
        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>bindings</span>[$abstract])) {
            <span style=color:#66d9ef>return</span> $abstract;
        }

        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>bindings</span>[$abstract][<span style=color:#e6db74>&#39;concrete&#39;</span>];
    }

    <span style=color:#75715e>//å®ä¾‹åŒ–å¯¹è±¡
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>build</span>($concrete) {

        <span style=color:#66d9ef>if</span>($concrete <span style=color:#a6e22e>instanceof</span> <span style=color:#a6e22e>Closure</span>) {
            <span style=color:#66d9ef>return</span> $concrete($this);
        }

        $reflector <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ReflectionClass</span>($concrete);
        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$reflector<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isInstantiable</span>()) {
            <span style=color:#66d9ef>echo</span> $message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Target [</span><span style=color:#e6db74>$concrete</span><span style=color:#e6db74>] is not instantiable&#34;</span>;
        }

        $constructor <span style=color:#f92672>=</span> $reflector<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getConstructor</span>();
        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>is_null</span>($constructor)) {
            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> $concrete;
        }

        $dependencies <span style=color:#f92672>=</span> $constructor<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getParameters</span>();
        $instances <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getDependencies</span>($dependencies);

        <span style=color:#66d9ef>return</span> $reflector<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>newInstanceArgs</span>($instances);
    }

    <span style=color:#75715e>//è§£å†³é€šè¿‡åå°„æœºåˆ¶å®ä¾‹åŒ–å¯¹è±¡æ—¶çš„ä¾èµ–
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getDependencies</span>($parameters) {
        $dependencies <span style=color:#f92672>=</span> [];
        <span style=color:#66d9ef>foreach</span>($parameters <span style=color:#66d9ef>as</span> $parameter) {
            $dependency <span style=color:#f92672>=</span> $parameter<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getClass</span>();
            <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>is_null</span>($dependency)) {
                $dependencies[] <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>;
            } <span style=color:#66d9ef>else</span> {
                $dependencies[] <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>resolveClass</span>($parameter);
            }
        }

        <span style=color:#66d9ef>return</span> (<span style=color:#66d9ef>array</span>)$dependencies;
    }

    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>resolveClass</span>(<span style=color:#a6e22e>ReflectionParameter</span> $parameter) {
        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>make</span>($parameter<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getClass</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>name</span>);
    }

}
</code></pre></div><p>ä»¥ä¸Šä»£ç å®šä¹‰äº†ä¸€ä¸ªå®¹å™¨</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$app <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Container</span>();
$app<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>bind</span>(<span style=color:#e6db74>&#34;Login&#34;</span>, <span style=color:#e6db74>&#34;WechatLogin&#34;</span>);<span style=color:#75715e>//Login ä¸ºæ¥å£ï¼Œ WechatLogin æ˜¯ class WechatLogin
</span><span style=color:#75715e></span>$app<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>bind</span>(<span style=color:#e6db74>&#34;siteLogin&#34;</span>, <span style=color:#e6db74>&#34;SiteLogin&#34;</span>); <span style=color:#75715e>//siteLoginå¯ä»¥å½“åšæ˜¯Class SiteLogin çš„æœåŠ¡åˆ«å
</span><span style=color:#75715e></span>
<span style=color:#75715e>//é€šè¿‡å­—ç¬¦è§£æï¼Œæˆ–å¾—åˆ°äº†Class SiteLogin çš„å®ä¾‹
</span><span style=color:#75715e></span>$login <span style=color:#f92672>=</span> $app<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>make</span>(<span style=color:#e6db74>&#34;siteLogin&#34;</span>);

$login<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>appLogin</span>();
</code></pre></div><h3 id=å‚è€ƒ>å‚è€ƒ<a hidden class=anchor aria-hidden=true href=#å‚è€ƒ>#</a></h3><blockquote><ul><li><a href=https://laravel-china.org/articles/4076/how-to-understand-laravels-ioc-container>å¦‚ä½•ç†è§£ Laravel çš„ IoC å®¹å™¨</a></li><li><a href=https://medium.com/@NahidulHasan/laravel-ioc-container-why-we-need-it-and-how-it-works-a603d4cef10f><strong>Laravel IoC Container: Why we need it and How it works</strong></a></li><li><a href=https://laravel.com/docs/5.6/container>Laravel5.6æ–‡æ¡£</a></li></ul></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=http://shawnrong.github.io/tags/php/>PHP</a></li><li><a href=http://shawnrong.github.io/tags/composer/>Composer</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2021 <a href=http://shawnrong.github.io/>ğŸ’ŠTime Capsule</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=http://shawnrong.github.io/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});if(id==="top"){history.replaceState(null,null," ");}else{history.replaceState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script></body></html>